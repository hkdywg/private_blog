

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2.6.1. 进程描述 &mdash; ywg_dev_doc 0.1 文档</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script src="../../../_static/translations.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../search.html" />
    <link rel="next" title="2.6.2. 进程创建" href="../process_create/index.html" />
    <link rel="prev" title="2.6. 进程管理与调度" href="../index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> ywg_dev_doc
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../u-boot/index.html">1. u-boot dev note</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">2. kernel note</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../debug/index.html">2.1. linux kernel debug tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dts/index.html">2.2. DTS设备树详解</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../list/index.html">2.3. linux 通用双向循环链表</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kernel_function/index.html">2.4. linux 内核函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../queue/index.html">2.5. kernel queue note</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">2.6. 进程管理与调度</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">2.6.1. 进程描述</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">2.6.1.1. 进程状态</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">2.6.1.2. 进程描述符</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">2.6.1.3. 进程内核栈</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">2.6.1.4. 进程标记</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">2.6.1.5. 表示进程亲属关系的成员</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">2.6.1.6. 优先级</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">2.6.1.7. 调度策略相关字段</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id10">2.6.1.8. 调度类</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id11">2.6.1.9. 进程地址空间</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id12">2.6.1.10. 判断标志</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id13">2.6.1.11. 时间</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id14">2.6.1.12. 信号处理</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id15">2.6.1.13. 其他</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../process_create/index.html">2.6.2. 进程创建</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process_run/index.html">2.6.3. 进程运行</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process_quite/index.html">2.6.4. 进程退出</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process_schedule/index.html">2.6.5. 进程调度</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process_cfs/index.html">2.6.6. 调度普通进程-完全公平调度器CFS</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../driver/index.html">3. linux driver modules note</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fs/index.html">4. file system note</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user/index.html">5. application development node</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/index.html">6. misc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../issues/index.html">7. Issues</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ywg_dev_doc</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html"><span class="section-number">2. </span>kernel note</a> &raquo;</li>
        
          <li><a href="../index.html"><span class="section-number">2.6. </span>进程管理与调度</a> &raquo;</li>
        
      <li><span class="section-number">2.6.1. </span>进程描述</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/kernel/process/process_overview/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1><span class="section-number">2.6.1. </span>进程描述<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<p>进程是出于执行期的程序以及它所管理的资源(如打开的文件、挂起的信号、进程状态、地址空间等等)的总称。
注意，程序不是进程，实际上两个或者多个进程有可能执行同意程序，而且还可能共享地址空间等资源。</p>
<p>linux通过一个被称为进程描述符的 <code class="docutils literal notranslate"><span class="pre">task_struct</span></code> 结构体来管理进程，这个结构体包含了一个进程所需要的所有信息. 它定义在 <code class="docutils literal notranslate"><span class="pre">include/linux/sched.h</span></code> 文件中</p>
<div class="section" id="id2">
<h2><span class="section-number">2.6.1.1. </span>进程状态<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">volatitle</span> <span class="n">long</span> <span class="n">state</span><span class="p">;</span>   <span class="o">/*</span> <span class="o">-</span><span class="mi">1</span> <span class="n">unrunnable</span><span class="p">,</span> <span class="mi">0</span> <span class="n">runnable</span><span class="p">,</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="n">stopped</span> <span class="o">*/</span>
</pre></div>
</div>
<p>state成员可能取值如下</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/*
 * Task state bitmask. NOTE! These bits are also
 * encoded in fs/proc/array.c: get_task_state().
 *
 * We have two separate sets of flags: task-&gt;state
 * is about runnability, while task-&gt;exit_state are
 * about the task exiting. Confusing, but this way
 * modifying one set can&#39;t modify the other one by
 * mistake.
 */

/* Used in tsk-&gt;state: */
#define TASK_RUNNING                        0x0000
#define TASK_INTERRUPTIBLE          0x0001
#define TASK_UNINTERRUPTIBLE                0x0002
#define __TASK_STOPPED                      0x0004
#define __TASK_TRACED                       0x0008
/* Used in tsk-&gt;exit_state: */
#define EXIT_DEAD                   0x0010
#define EXIT_ZOMBIE                 0x0020
#define EXIT_TRACE                  (EXIT_ZOMBIE | EXIT_DEAD)
/* Used in tsk-&gt;state again: */
#define TASK_PARKED                 0x0040
#define TASK_DEAD                   0x0080
#define TASK_WAKEKILL                       0x0100
#define TASK_WAKING                 0x0200
#define TASK_NOLOAD                 0x0400
#define TASK_NEW                    0x0800
#define TASK_STATE_MAX                      0x1000
</pre></div>
</div>
<p>state域能够取5个互为排斥的值,系统中的每个进程都必然处于以上所列进程状态中的一中。</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 74%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>state</p></th>
<th class="head"><p>描述</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>TASK_RUNNING</p></td>
<td><p>表示进程要么正在执行或者已经就绪，正在等待cpu时间片的调度</p></td>
</tr>
<tr class="row-odd"><td><p>TASK_INTERRUPTIBLE</p></td>
<td><p>进程因为等待一些条件而被挂起(阻塞)而处的状态，这些条件主要包括硬
中断、资源、信号…，一旦等待的条件成立，进程就会从该状态迅速转换
为TASK_RUNNING</p></td>
</tr>
<tr class="row-even"><td><p>TASK_UNINTERRUPTIBLE</p></td>
<td><p>意义与TASK_INTERRUPTIBLE类似,不同的是中断、信号不能唤醒它们，只能
在它所等待的资源可用的时候，才会被唤醒。</p></td>
</tr>
<tr class="row-odd"><td><p>TASK_STOPPED</p></td>
<td><p>进程被停止执行，当进程收到SIGSTOP SIGTTIN SIGTSTP或者SIGTOU 信号
之后就会进入该状态</p></td>
</tr>
<tr class="row-even"><td><p>TASK_TRACED</p></td>
<td><p>进程被debugger等进程监视</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>2个中止状态</p></li>
</ul>
<p>只有当进程终止的时候才会达到这两种状态</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">exit_state</span><span class="p">;</span>
<span class="nb">int</span> <span class="n">exit_code</span><span class="p">,</span> <span class="n">exit_signal</span><span class="p">;</span>
</pre></div>
</div>
<p>当进程被终止时,其父进程还没有使用wait()等系统调用来获取它的终止信息,此时进程称为僵尸进程    <code class="docutils literal notranslate"><span class="pre">EXIT_ZOMBIE</span></code></p>
<p>进程的最终状态 <code class="docutils literal notranslate"><span class="pre">EXIT_DEAD</span></code></p>
<ul class="simple">
<li><p>睡眠状态</p></li>
</ul>
<p>TASK_INTERRUPTBLTE 和 TASK_UNINTERRUPTBLTE 这两种状态都属于睡眠状态.</p>
<p>linux内核提供了两种方法将进程置为睡眠状态</p>
<ol class="arabic simple">
<li><p>如果进程处于可中断模式的睡眠状态,那么可以通过显示的唤醒(wakeup_process())或需要处理的信号来唤醒它</p></li>
<li><p>如果进程处于非可中断模式的睡眠状态，那么只能通过显示的唤醒呼叫将其唤醒,除非万不得已否则不建议将进程置为不可中断睡眠模式</p></li>
</ol>
<p>内核中还有一种新的睡眠状态, <code class="docutils literal notranslate"><span class="pre">TASK_KILLABLE</span></code></p>
<p>它的运行原理与 TASK_UNINTERRUPTIBLE 类似，只不过可以响应致命信号</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span> <span class="n">Convenience</span> <span class="n">macros</span> <span class="k">for</span> <span class="n">the</span> <span class="n">sake</span> <span class="n">of</span> <span class="n">set_current_state</span><span class="p">:</span> <span class="o">*/</span>
<span class="c1">#define TASK_KILLABLE                       (TASK_WAKEKILL | TASK_UNINTERRUPTIBLE)</span>
<span class="c1">#define TASK_STOPPED                        (TASK_WAKEKILL | __TASK_STOPPED)</span>
<span class="c1">#define TASK_TRACED                 (TASK_WAKEKILL | __TASK_TRACED)</span>

<span class="c1">#define TASK_IDLE                   (TASK_UNINTERRUPTIBLE | TASK_NOLOAD)</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h2><span class="section-number">2.6.1.2. </span>进程描述符<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pid_t</span> <span class="n">pid</span><span class="p">;</span>
<span class="n">pid_t</span> <span class="n">tgid</span><span class="p">;</span>
</pre></div>
</div>
<p>unix系统通过pid来标识进程,linux把不同的pid与系统中每个进程或轻量级线程关联,一个线程所有线程与领头线程具有相同的pid，存入tgid字段，getpid()返回当前进程的tgid
而不是pid的值</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#define PID_MAX_DEFAULT (CONFIG_BASE_SMALL ? 0x1000 : 0x8000)
#define PID_MAX_LIMIT (CONFIG_BASE_SMALL ? PAGE_SIZE * 8 : \
                        (sizeof(long) &gt; 4 ? 4 * 1024 * 1024 : PID_MAX_DEFAULT))
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h2><span class="section-number">2.6.1.3. </span>进程内核栈<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="o">*</span><span class="n">stack</span><span class="p">;</span>
</pre></div>
</div>
<div class="section" id="id5">
<h3><span class="section-number">2.6.1.3.1. </span>内核栈与线程描述符<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h3>
<p>对于每个进程，linux内核把两个不同的数据结构紧凑的存放在一个单独为进程分配的内存区域中</p>
<ol class="arabic simple">
<li><p>一个是内核态的进程堆栈</p></li>
</ol>
<p>2)另一个是紧挨着进程描述符的小数据结构 <code class="docutils literal notranslate"><span class="pre">thread_info</span></code> ,叫做线程描述符</p>
<p>linux把 thread_info 和内核态的线程堆栈放在一起，这块区域通常是8192(占两个页框)，其实地址必须是8192的整数倍</p>
<p>内核太的进程访问处于内核数据段的栈,这个栈不同于用户态的进程所用的栈.用户态的进程所用的栈,是在进程线性地址空间中。而内核栈是当前进程从用户空间进入内核空间时，
特权级别发生变化需要切换堆栈，那么内空间中使用的就是这个内核栈</p>
</div>
<div class="section" id="thread-infothread-union">
<h3><span class="section-number">2.6.1.3.2. </span>内核栈数据接哦古描述thread_info和thread_union<a class="headerlink" href="#thread-infothread-union" title="永久链接至标题">¶</a></h3>
<p>thread_info是体系结构相关的,结构的定义在thread_info.h中， arm64体系结构中位于arch/arm64/include/asm/thread_info.h</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span>
 <span class="o">*</span> <span class="n">low</span> <span class="n">level</span> <span class="n">task</span> <span class="n">data</span> <span class="n">that</span> <span class="n">entry</span><span class="o">.</span><span class="n">S</span> <span class="n">needs</span> <span class="n">immediate</span> <span class="n">access</span> <span class="n">to</span><span class="o">.</span>
 <span class="o">*/</span>
<span class="n">struct</span> <span class="n">thread_info</span> <span class="p">{</span>
    <span class="n">unsigned</span> <span class="n">long</span>           <span class="n">flags</span><span class="p">;</span>          <span class="o">/*</span> <span class="n">low</span> <span class="n">level</span> <span class="n">flags</span> <span class="o">*/</span>
    <span class="n">mm_segment_t</span>            <span class="n">addr_limit</span><span class="p">;</span>     <span class="o">/*</span> <span class="n">address</span> <span class="n">limit</span> <span class="o">*/</span>
<span class="c1">#ifdef CONFIG_ARM64_SW_TTBR0_PAN</span>
    <span class="n">u64</span>                     <span class="n">ttbr0</span><span class="p">;</span>          <span class="o">/*</span> <span class="n">saved</span> <span class="n">TTBR0_EL1</span> <span class="o">*/</span>
<span class="c1">#endif</span>
    <span class="n">union</span> <span class="p">{</span>
        <span class="n">u64</span>         <span class="n">preempt_count</span><span class="p">;</span>  <span class="o">/*</span> <span class="mi">0</span> <span class="o">=&gt;</span> <span class="n">preemptible</span><span class="p">,</span> <span class="o">&lt;</span><span class="mi">0</span> <span class="o">=&gt;</span> <span class="n">bug</span> <span class="o">*/</span>
        <span class="n">struct</span> <span class="p">{</span>
<span class="c1">#ifdef CONFIG_CPU_BIG_ENDIAN</span>
            <span class="n">u32</span>     <span class="n">need_resched</span><span class="p">;</span>
            <span class="n">u32</span>     <span class="n">count</span><span class="p">;</span>
<span class="c1">#else</span>
            <span class="n">u32</span>     <span class="n">count</span><span class="p">;</span>
            <span class="n">u32</span>     <span class="n">need_resched</span><span class="p">;</span>
<span class="c1">#endif</span>
        <span class="p">}</span> <span class="n">preempt</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">};</span>
</pre></div>
</div>
<p>linux 内核中使用一个联合体来表示一个进程的线程描述符和内核栈</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">union</span> <span class="n">thread_union</span> <span class="p">{</span>
<span class="c1">#ifndef CONFIG_ARCH_TASK_STRUCT_ON_STACK</span>
    <span class="n">struct</span> <span class="n">task_struct</span> <span class="n">task</span><span class="p">;</span>
<span class="c1">#endif</span>
<span class="c1">#ifndef CONFIG_THREAD_INFO_IN_TASK</span>
    <span class="n">struct</span> <span class="n">thread_info</span> <span class="n">thread_info</span><span class="p">;</span>
<span class="c1">#endif</span>
    <span class="n">unsigned</span> <span class="n">long</span> <span class="n">stack</span><span class="p">[</span><span class="n">THREAD_SIZE</span><span class="o">/</span><span class="n">sizeof</span><span class="p">(</span><span class="n">long</span><span class="p">)];</span>
<span class="p">};</span>
</pre></div>
</div>
<ul class="simple">
<li><p>获取当前CPU上正在运行进程的thread_info</p></li>
</ul>
<p>进程最常用的是进程描述符结构task_struct而不是thread_info结构的地址，为了获取当前CPU上运行进程的task_struct结构，内核提供了current宏,由于task_struct task 在thread_info的起始位置，该宏
本质上current_thread_info()-&gt;task</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">static</span> <span class="n">__always_inline</span> <span class="n">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">get_current</span><span class="p">(</span><span class="n">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">unsigned</span> <span class="n">long</span> <span class="n">sp_el0</span><span class="p">;</span>

    <span class="n">asm</span> <span class="p">(</span><span class="s2">&quot;mrs %0, sp_el0&quot;</span> <span class="p">:</span> <span class="s2">&quot;=r&quot;</span> <span class="p">(</span><span class="n">sp_el0</span><span class="p">));</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="p">)</span><span class="n">sp_el0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">#define current get_current()</span>

<span class="c1">#define current_thread_info() ((struct thread_info *)current)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>分配和销毁thread_info</p></li>
</ul>
<p>进程通过alloc_thread_info_node函数分配它的内核栈，通过free_thread_info函数释放所分配的内核栈</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">static</span> <span class="n">struct</span> <span class="n">kmem_cache</span> <span class="o">*</span><span class="n">thread_stack_cache</span><span class="p">;</span>

<span class="n">static</span> <span class="n">unsigned</span> <span class="n">long</span> <span class="o">*</span><span class="n">alloc_thread_stack_node</span><span class="p">(</span><span class="n">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">tsk</span><span class="p">,</span>
                          <span class="nb">int</span> <span class="n">node</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">unsigned</span> <span class="n">long</span> <span class="o">*</span><span class="n">stack</span><span class="p">;</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="n">kmem_cache_alloc_node</span><span class="p">(</span><span class="n">thread_stack_cache</span><span class="p">,</span> <span class="n">THREADINFO_GFP</span><span class="p">,</span> <span class="n">node</span><span class="p">);</span>
    <span class="n">tsk</span><span class="o">-&gt;</span><span class="n">stack</span> <span class="o">=</span> <span class="n">stack</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">stack</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">static</span> <span class="n">void</span> <span class="n">free_thread_stack</span><span class="p">(</span><span class="n">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">tsk</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">kmem_cache_free</span><span class="p">(</span><span class="n">thread_stack_cache</span><span class="p">,</span> <span class="n">tsk</span><span class="o">-&gt;</span><span class="n">stack</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">void</span> <span class="n">thread_stack_cache_init</span><span class="p">(</span><span class="n">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">thread_stack_cache</span> <span class="o">=</span> <span class="n">kmem_cache_create_usercopy</span><span class="p">(</span><span class="s2">&quot;thread_stack&quot;</span><span class="p">,</span>
                    <span class="n">THREAD_SIZE</span><span class="p">,</span> <span class="n">THREAD_SIZE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="n">THREAD_SIZE</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
    <span class="n">BUG_ON</span><span class="p">(</span><span class="n">thread_stack_cache</span> <span class="o">==</span> <span class="n">NULL</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id6">
<h2><span class="section-number">2.6.1.4. </span>进程标记<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h2>
<dl class="simple">
<dt>::</dt><dd><p>unsigned int flags;</p>
</dd>
</dl>
<p>反应进程状态信息，但不是运行状态，用于内核识别进程当前状态，以备下一步操作</p>
<p>flags成员可能取值如下,这些以PF(processflag)开头</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span>
 <span class="o">*</span> <span class="n">Per</span> <span class="n">process</span> <span class="n">flags</span>
 <span class="o">*/</span>
<span class="c1">#define PF_IDLE                     0x00000002      /* I am an IDLE thread */</span>
<span class="c1">#define PF_EXITING          0x00000004      /* Getting shut down */</span>
<span class="c1">#define PF_VCPU                     0x00000010      /* I&#39;m a virtual CPU */</span>
<span class="c1">#define PF_WQ_WORKER                0x00000020      /* I&#39;m a workqueue worker */</span>
<span class="c1">#define PF_FORKNOEXEC               0x00000040      /* Forked but didn&#39;t exec */</span>
<span class="c1">#define PF_MCE_PROCESS              0x00000080      /* Process policy on mce errors */</span>
<span class="c1">#define PF_SUPERPRIV                0x00000100      /* Used super-user privileges */</span>
<span class="c1">#define PF_DUMPCORE         0x00000200      /* Dumped core */</span>
<span class="c1">#define PF_SIGNALED         0x00000400      /* Killed by a signal */</span>
<span class="c1">#define PF_MEMALLOC         0x00000800      /* Allocating memory */</span>
<span class="c1">#define PF_NPROC_EXCEEDED   0x00001000      /* set_user() noticed that RLIMIT_NPROC was exceeded */</span>
<span class="c1">#define PF_USED_MATH                0x00002000      /* If unset the fpu must be initialized before use */</span>
<span class="c1">#define PF_USED_ASYNC               0x00004000      /* Used async_schedule*(), used by module init */</span>
<span class="c1">#define PF_NOFREEZE         0x00008000      /* This thread should not be frozen */</span>
<span class="c1">#define PF_FROZEN           0x00010000      /* Frozen for system suspend */</span>
<span class="c1">#define PF_KSWAPD           0x00020000      /* I am kswapd */</span>
<span class="c1">#define PF_MEMALLOC_NOFS    0x00040000      /* All allocation requests will inherit GFP_NOFS */</span>
<span class="c1">#define PF_MEMALLOC_NOIO    0x00080000      /* All allocation requests will inherit GFP_NOIO */</span>
<span class="c1">#define PF_LESS_THROTTLE    0x00100000      /* Throttle me less: I clean memory */</span>
<span class="c1">#define PF_KTHREAD          0x00200000      /* I am a kernel thread */</span>
<span class="c1">#define PF_RANDOMIZE                0x00400000      /* Randomize virtual address space */</span>
<span class="c1">#define PF_SWAPWRITE                0x00800000      /* Allowed to write to swap */</span>
<span class="c1">#define PF_MEMSTALL         0x01000000      /* Stalled due to lack of memory */</span>
<span class="c1">#define PF_UMH                      0x02000000      /* I&#39;m an Usermodehelper process */</span>
<span class="c1">#define PF_NO_SETAFFINITY   0x04000000      /* Userland is not allowed to meddle with cpus_mask */</span>
<span class="c1">#define PF_MCE_EARLY                0x08000000      /* Early kill for mce process policy */</span>
<span class="c1">#define PF_MEMALLOC_NOCMA   0x10000000      /* All allocation request will have _GFP_MOVABLE cleared */</span>
<span class="c1">#define PF_FREEZER_SKIP             0x40000000      /* Freezer should not count it as freezable */</span>
<span class="c1">#define PF_SUSPEND_TASK             0x80000000      /* This thread called freeze_processes() and should not be frozen */</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h2><span class="section-number">2.6.1.5. </span>表示进程亲属关系的成员<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span> <span class="n">Real</span> <span class="n">parent</span> <span class="n">process</span><span class="p">:</span> <span class="o">*/</span>
<span class="n">struct</span> <span class="n">task_struct</span> <span class="n">__rcu</span>        <span class="o">*</span><span class="n">real_parent</span><span class="p">;</span>

<span class="o">/*</span> <span class="n">Recipient</span> <span class="n">of</span> <span class="n">SIGCHLD</span><span class="p">,</span> <span class="n">wait4</span><span class="p">()</span> <span class="n">reports</span><span class="p">:</span> <span class="o">*/</span>
<span class="n">struct</span> <span class="n">task_struct</span> <span class="n">__rcu</span>        <span class="o">*</span><span class="n">parent</span><span class="p">;</span>

<span class="o">/*</span>
 <span class="o">*</span> <span class="n">Children</span><span class="o">/</span><span class="n">sibling</span> <span class="n">form</span> <span class="n">the</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">natural</span> <span class="n">children</span><span class="p">:</span>
 <span class="o">*/</span>
<span class="n">struct</span> <span class="n">list_head</span>                <span class="n">children</span><span class="p">;</span>
<span class="n">struct</span> <span class="n">list_head</span>                <span class="n">sibling</span><span class="p">;</span>
<span class="n">struct</span> <span class="n">task_struct</span>              <span class="o">*</span><span class="n">group_leader</span><span class="p">;</span>
</pre></div>
</div>
<p>linux 系统中所有进程之间都直接或者间接的存在关系</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>字段</p></th>
<th class="head"><p>描述</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>real_patent</p></td>
<td><p>指向父进程,如果创建它的父进程不存在了则指向PID为1的init进程</p></td>
</tr>
<tr class="row-odd"><td><p>parent</p></td>
<td><p>指向父进程，当它终止时，必须向它的父进程发送信号,一般与real_parent相同</p></td>
</tr>
<tr class="row-even"><td><p>children</p></td>
<td><p>表示链表的头部，链表中的所有元素都是它的子进程</p></td>
</tr>
<tr class="row-odd"><td><p>sibling</p></td>
<td><p>用于吧当前进程插入到兄弟链表中</p></td>
</tr>
<tr class="row-even"><td><p>group_leader</p></td>
<td><p>指向其所在进程组的领头进程</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id8">
<h2><span class="section-number">2.6.1.6. </span>优先级<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span>                             <span class="n">prio</span><span class="p">;</span>
<span class="nb">int</span>                             <span class="n">static_prio</span><span class="p">;</span>
<span class="nb">int</span>                             <span class="n">normal_prio</span><span class="p">;</span>
<span class="n">unsigned</span> <span class="nb">int</span>                    <span class="n">rt_priority</span><span class="p">;</span>
</pre></div>
</div>
<p>实时优先级的范围时0-MAX_RT_PRIO-1(即99)，而普通进程的静态优先级范围时MAX_RT_PRIO到MAX_PRIO-1(即100-139),
值越大优先级越低</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 83%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>字段</p></th>
<th class="head"><p>描述</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>static_prio</p></td>
<td><p>用于保存静态优先级,可以通过nice系统调用来进行修改</p></td>
</tr>
<tr class="row-odd"><td><p>prio</p></td>
<td><p>用于保存动态优先级</p></td>
</tr>
<tr class="row-even"><td><p>normal_pro</p></td>
<td><p>normal_prio的值取决于静态优先级和调度策略</p></td>
</tr>
<tr class="row-odd"><td><p>rt_priority</p></td>
<td><p>用于保存实时优先级</p></td>
</tr>
</tbody>
</table>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/**</span>
 <span class="o">*</span> <span class="n">task_nice</span> <span class="o">-</span> <span class="k">return</span> <span class="n">the</span> <span class="n">nice</span> <span class="n">value</span> <span class="n">of</span> <span class="n">a</span> <span class="n">given</span> <span class="n">task</span><span class="o">.</span>
 <span class="o">*</span> <span class="nd">@p</span><span class="p">:</span> <span class="n">the</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">question</span><span class="o">.</span>
 <span class="o">*</span>
 <span class="o">*</span> <span class="n">Return</span><span class="p">:</span> <span class="n">The</span> <span class="n">nice</span> <span class="n">value</span> <span class="p">[</span> <span class="o">-</span><span class="mi">20</span> <span class="o">...</span> <span class="mi">0</span> <span class="o">...</span> <span class="mi">19</span> <span class="p">]</span><span class="o">.</span>
 <span class="o">*/</span>
<span class="n">static</span> <span class="n">inline</span> <span class="nb">int</span> <span class="n">task_nice</span><span class="p">(</span><span class="n">const</span> <span class="n">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">PRIO_TO_NICE</span><span class="p">((</span><span class="n">p</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">static_prio</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>prio定义如下</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#define MAX_NICE    19</span>
<span class="c1">#define MIN_NICE    -20</span>
<span class="c1">#define NICE_WIDTH  (MAX_NICE - MIN_NICE + 1)</span>

<span class="c1">#define MAX_USER_RT_PRIO    100</span>
<span class="c1">#define MAX_RT_PRIO     MAX_USER_RT_PRIO</span>
<span class="c1">#define DEFAULT_PRIO        (MAX_RT_PRIO + NICE_WIDTH / 2)</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h2><span class="section-number">2.6.1.7. </span>调度策略相关字段<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unsigned</span> <span class="nb">int</span>                    <span class="n">policy</span><span class="p">;</span>
<span class="n">cpumask_t</span>                       <span class="n">cpus_mask</span><span class="p">;</span>

<span class="n">const</span> <span class="n">struct</span> <span class="n">sched_class</span>        <span class="o">*</span><span class="n">sched_class</span><span class="p">;</span>
<span class="n">struct</span> <span class="n">sched_entity</span>             <span class="n">se</span><span class="p">;</span>
<span class="n">struct</span> <span class="n">sched_rt_entity</span>          <span class="n">rt</span><span class="p">;</span>
<span class="n">struct</span> <span class="n">sched_dl_entity</span>          <span class="n">dl</span><span class="p">;</span>
</pre></div>
</div>
<p>各字段定义如下</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 22%" />
<col style="width: 78%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>字段</p></th>
<th class="head"><p>描述</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>polocy</p></td>
<td><p>调度策略</p></td>
</tr>
<tr class="row-odd"><td><p>sched_class</p></td>
<td><p>调度类</p></td>
</tr>
<tr class="row-even"><td><p>se</p></td>
<td><p>普通进程的调用实体,每个进程都有其中之一的实体</p></td>
</tr>
<tr class="row-odd"><td><p>rt</p></td>
<td><p>实时进程的调度实体</p></td>
</tr>
<tr class="row-even"><td><p>dl</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>cpus_allowed</p></td>
<td><p>用于控制进程可以在那个CPU上运行</p></td>
</tr>
</tbody>
</table>
<p>policy表示调度策略,目前主要有以下5种</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span>
 <span class="o">*</span> <span class="n">Scheduling</span> <span class="n">policies</span>
 <span class="o">*/</span>
<span class="c1">#define SCHED_NORMAL                0</span>
<span class="c1">#define SCHED_FIFO          1</span>
<span class="c1">#define SCHED_RR            2</span>
<span class="c1">#define SCHED_BATCH         3</span>
<span class="o">/*</span> <span class="n">SCHED_ISO</span><span class="p">:</span> <span class="n">reserved</span> <span class="n">but</span> <span class="ow">not</span> <span class="n">implemented</span> <span class="n">yet</span> <span class="o">*/</span>
<span class="c1">#define SCHED_IDLE          5</span>
<span class="c1">#define SCHED_DEADLINE              6</span>
</pre></div>
</div>
<p>调度策略描述如下</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 78%" />
<col style="width: 7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>字段</p></th>
<th class="head"><p>描述</p></th>
<th class="head"><p>调度器</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SCHED_NORMAL</p></td>
<td><p>用于普通进程,通过CFS调度器实现</p></td>
<td><p>cfs</p></td>
</tr>
<tr class="row-odd"><td><p>SCHED_BATCH</p></td>
<td><p>SCHED_NORMAL普通进程的分化版本,采用分时策略,根据动态优先级,分配CPU运算资源.</p></td>
<td><p>cfs</p></td>
</tr>
<tr class="row-even"><td><p>SCHED_IDLE</p></td>
<td><p>优先级最低，只有在系统空闲时才跑这类进程</p></td>
<td><p>cfs</p></td>
</tr>
<tr class="row-odd"><td><p>SCHED_FIFO</p></td>
<td><p>先入先出(实时调度策略),相同优先级的先到先服务，高优先级的可以抢占低优先级的任务</p></td>
<td><p>rt</p></td>
</tr>
<tr class="row-even"><td><p>SCHED_RR</p></td>
<td><p>轮流调度算法(实时调度策略),采用时间片，相同优先级的当用完时间片以后会被放到队列尾部,以保证
公平性,高优先级的可以抢占低优先级的</p></td>
<td><p>rt</p></td>
</tr>
<tr class="row-odd"><td><p>SCHED_DEADLINE</p></td>
<td><p>新支持的实时进程调度策略,针对突发型计算,且对延迟和完成时间高度敏感的任务适用.</p></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id10">
<h2><span class="section-number">2.6.1.8. </span>调度类<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">extern</span> <span class="n">const</span> <span class="n">struct</span> <span class="n">sched_class</span> <span class="n">stop_sched_class</span><span class="p">;</span>
<span class="n">extern</span> <span class="n">const</span> <span class="n">struct</span> <span class="n">sched_class</span> <span class="n">dl_sched_class</span><span class="p">;</span>
<span class="n">extern</span> <span class="n">const</span> <span class="n">struct</span> <span class="n">sched_class</span> <span class="n">rt_sched_class</span><span class="p">;</span>
<span class="n">extern</span> <span class="n">const</span> <span class="n">struct</span> <span class="n">sched_class</span> <span class="n">fair_sched_class</span><span class="p">;</span>
<span class="n">extern</span> <span class="n">const</span> <span class="n">struct</span> <span class="n">sched_class</span> <span class="n">idle_sched_class</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h2><span class="section-number">2.6.1.9. </span>进程地址空间<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="n">mm_struct</span>                <span class="o">*</span><span class="n">mm</span><span class="p">;</span>
<span class="n">struct</span> <span class="n">mm_struct</span>                <span class="o">*</span><span class="n">active_mm</span><span class="p">;</span>

<span class="o">/*</span> <span class="n">Per</span><span class="o">-</span><span class="n">thread</span> <span class="n">vma</span> <span class="n">caching</span><span class="p">:</span> <span class="o">*/</span>
<span class="n">struct</span> <span class="n">vmacache</span>                 <span class="n">vmacache</span><span class="p">;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 81%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>字段</p></th>
<th class="head"><p>描述</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>mm</p></td>
<td><p>进程所用于的用户地址空间描述符,内核线程mm为NULL</p></td>
</tr>
<tr class="row-odd"><td><p>active_mm</p></td>
<td><p>普通进程与mm的值相同,内核线程时被初始化为前一个运行进程的active_mm的值</p></td>
</tr>
<tr class="row-even"><td><p>vmacache</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>如果当前内核线程被调度之前运行的是另外一个内核线程的时候,那么mm和active_mm都是NULL</p>
</div>
<div class="section" id="id12">
<h2><span class="section-number">2.6.1.10. </span>判断标志<a class="headerlink" href="#id12" title="永久链接至标题">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span>                             <span class="n">exit_state</span><span class="p">;</span>
<span class="nb">int</span>                             <span class="n">exit_code</span><span class="p">;</span>
<span class="nb">int</span>                             <span class="n">exit_signal</span><span class="p">;</span>
<span class="o">/*</span> <span class="n">The</span> <span class="n">signal</span> <span class="n">sent</span> <span class="n">when</span> <span class="n">the</span> <span class="n">parent</span> <span class="n">dies</span><span class="p">:</span> <span class="o">*/</span>
<span class="nb">int</span>                             <span class="n">pdeath_signal</span><span class="p">;</span>
<span class="o">/*</span> <span class="n">JOBCTL_</span><span class="o">*</span><span class="p">,</span> <span class="n">siglock</span> <span class="n">protected</span><span class="p">:</span> <span class="o">*/</span>
<span class="n">unsigned</span> <span class="n">long</span>                   <span class="n">jobctl</span><span class="p">;</span>

<span class="o">/*</span> <span class="n">Used</span> <span class="k">for</span> <span class="n">emulating</span> <span class="n">ABI</span> <span class="n">behavior</span> <span class="n">of</span> <span class="n">previous</span> <span class="n">Linux</span> <span class="n">versions</span><span class="p">:</span> <span class="o">*/</span>
<span class="n">unsigned</span> <span class="nb">int</span>                    <span class="n">personality</span><span class="p">;</span>

<span class="o">/*</span> <span class="n">Scheduler</span> <span class="n">bits</span><span class="p">,</span> <span class="n">serialized</span> <span class="n">by</span> <span class="n">scheduler</span> <span class="n">locks</span><span class="p">:</span> <span class="o">*/</span>
<span class="n">unsigned</span>                        <span class="n">sched_reset_on_fork</span><span class="p">:</span><span class="mi">1</span><span class="p">;</span>
<span class="n">unsigned</span>                        <span class="n">sched_contributes_to_load</span><span class="p">:</span><span class="mi">1</span><span class="p">;</span>
<span class="n">unsigned</span>                        <span class="n">sched_migrated</span><span class="p">:</span><span class="mi">1</span><span class="p">;</span>
<span class="n">unsigned</span>                        <span class="n">sched_remote_wakeup</span><span class="p">:</span><span class="mi">1</span><span class="p">;</span>

<span class="o">/*</span> <span class="n">Force</span> <span class="n">alignment</span> <span class="n">to</span> <span class="n">the</span> <span class="nb">next</span> <span class="n">boundary</span><span class="p">:</span> <span class="o">*/</span>
<span class="n">unsigned</span>                        <span class="p">:</span><span class="mi">0</span><span class="p">;</span>

<span class="o">/*</span> <span class="n">Unserialized</span><span class="p">,</span> <span class="n">strictly</span> <span class="s1">&#39;current&#39;</span> <span class="o">*/</span>

<span class="o">/*</span> <span class="n">Bit</span> <span class="n">to</span> <span class="n">tell</span> <span class="n">LSMs</span> <span class="n">we</span><span class="s1">&#39;re in execve(): */</span>
<span class="n">unsigned</span>                        <span class="n">in_execve</span><span class="p">:</span><span class="mi">1</span><span class="p">;</span>
<span class="n">unsigned</span>                        <span class="n">in_iowait</span><span class="p">:</span><span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<p>各字段描述如下</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 81%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>字段</p></th>
<th class="head"><p>描述</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>exit_code</p></td>
<td><p>用于设置进程的终止代号,要么是_exit()系统调用参数(正常终止)或者是内核提供的错误代号(异常终止)</p></td>
</tr>
<tr class="row-odd"><td><p>exit_signal</p></td>
<td><p>只有当线程组的最后与i个成员终止时,才会产生一个信号,以通知线程组的领头进程的父进程</p></td>
</tr>
<tr class="row-even"><td><p>pdeath_signal</p></td>
<td><p>用于判断父进程终止时发送信号</p></td>
</tr>
<tr class="row-odd"><td><p>persionality</p></td>
<td><p>用于处理不通的ABI</p></td>
</tr>
<tr class="row-even"><td><p>in_iowait</p></td>
<td><p>用于判断是否进行iowait计数</p></td>
</tr>
<tr class="row-odd"><td><p>sched_reset_on_fork</p></td>
<td><p>用于判断是否恢复默认的优先级或者调度策略</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id13">
<h2><span class="section-number">2.6.1.11. </span>时间<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">u64</span>                             <span class="n">utime</span><span class="p">;</span>
    <span class="n">u64</span>                             <span class="n">stime</span><span class="p">;</span>
<span class="n">u64</span>                         <span class="n">utimescaled</span><span class="p">;</span>
<span class="n">u64</span>                         <span class="n">stimescaled</span><span class="p">;</span>
<span class="n">u64</span>                         <span class="n">gtime</span><span class="p">;</span>
<span class="n">struct</span> <span class="n">prev_cputime</span>         <span class="n">prev_cputime</span><span class="p">;</span>

    <span class="n">unsigned</span> <span class="n">long</span>                   <span class="n">nvcsw</span><span class="p">;</span>
    <span class="n">unsigned</span> <span class="n">long</span>                   <span class="n">nivcsw</span><span class="p">;</span>

    <span class="n">u64</span>                             <span class="n">start_time</span><span class="p">;</span>

    <span class="n">u64</span>                             <span class="n">real_start_time</span><span class="p">;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 81%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>字段</p></th>
<th class="head"><p>描述</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>utime/stime</p></td>
<td><p>用于记录进程在用户态/内核态下所经过的节拍数字(定时器)</p></td>
</tr>
<tr class="row-odd"><td><p>utimescaled</p></td>
<td><p>用于记录进程在用户态的运行时间,但以处理器的频率为刻度</p></td>
</tr>
<tr class="row-even"><td><p>gtime</p></td>
<td><p>以节拍技术的虚拟机运行时间(guest time)</p></td>
</tr>
<tr class="row-odd"><td><p>vncsw/nivcsw</p></td>
<td><p>自愿和非自愿的上下文切换计数</p></td>
</tr>
<tr class="row-even"><td><p>start_time/real_s_t</p></td>
<td><p>进程创建时间,real_start_time包含了进程睡眠时间,常用于/proc/pid/stat</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id14">
<h2><span class="section-number">2.6.1.12. </span>信号处理<a class="headerlink" href="#id14" title="永久链接至标题">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span> <span class="n">Signal</span> <span class="n">handlers</span><span class="p">:</span> <span class="o">*/</span>
<span class="n">struct</span> <span class="n">signal_struct</span>            <span class="o">*</span><span class="n">signal</span><span class="p">;</span>
<span class="n">struct</span> <span class="n">sighand_struct</span>           <span class="o">*</span><span class="n">sighand</span><span class="p">;</span>
<span class="n">sigset_t</span>                        <span class="n">blocked</span><span class="p">;</span>
<span class="n">sigset_t</span>                        <span class="n">real_blocked</span><span class="p">;</span>
<span class="o">/*</span> <span class="n">Restored</span> <span class="k">if</span> <span class="n">set_restore_sigmask</span><span class="p">()</span> <span class="n">was</span> <span class="n">used</span><span class="p">:</span> <span class="o">*/</span>
<span class="n">sigset_t</span>                        <span class="n">saved_sigmask</span><span class="p">;</span>
<span class="n">struct</span> <span class="n">sigpending</span>               <span class="n">pending</span><span class="p">;</span>
<span class="n">unsigned</span> <span class="n">long</span>                   <span class="n">sas_ss_sp</span><span class="p">;</span>
<span class="n">size_t</span>                          <span class="n">sas_ss_size</span><span class="p">;</span>
<span class="n">unsigned</span> <span class="nb">int</span>                    <span class="n">sas_ss_flags</span><span class="p">;</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 81%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>字段</p></th>
<th class="head"><p>描述</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>signal</p></td>
<td><p>指向进程的信号描述符</p></td>
</tr>
<tr class="row-odd"><td><p>sighand</p></td>
<td><p>指向进程的信号处理程序描述符</p></td>
</tr>
<tr class="row-even"><td><p>blocked</p></td>
<td><p>表示被阻塞信号的掩码,real_blocked 表示临时掩码</p></td>
</tr>
<tr class="row-odd"><td><p>pending</p></td>
<td><p>存放私有挂起信号的数据结构</p></td>
</tr>
<tr class="row-even"><td><p>sas_ss_sp</p></td>
<td><p>是信号处理程序备用堆栈的地址,sas_ss_size表示堆栈的大小</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id15">
<h2><span class="section-number">2.6.1.13. </span>其他<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">spinlock_t</span> <span class="n">alloc_lock</span><span class="p">;</span>      <span class="o">//</span><span class="n">用于保护资源分配或者释放的自旋锁</span>
<span class="n">atomic_t</span> <span class="n">usage</span><span class="p">;</span>     <span class="o">//</span><span class="n">进程描述符使用计数</span><span class="p">,</span><span class="n">被置为2时</span><span class="p">,</span><span class="n">表示进程描述符正在被使用而且其相应的进程处于活动状态</span>
<span class="n">struct</span> <span class="n">sched_info</span> <span class="n">sched_info</span><span class="p">;</span>       <span class="o">//</span><span class="n">用于调度器统计进程的运行信息</span>
<span class="n">struct</span> <span class="n">list_head</span> <span class="n">tasks</span><span class="p">;</span>     <span class="o">//</span><span class="n">用于构建进程链表</span>
<span class="nb">int</span> <span class="n">link_count</span><span class="p">,</span> <span class="n">total_link_count</span><span class="p">;</span>
<span class="n">struct</span> <span class="n">fs_struct</span> <span class="o">*</span><span class="n">fs</span><span class="p">;</span>   <span class="o">//</span><span class="n">fs用来表示进程与文件系统的联系</span><span class="p">,</span><span class="n">包括当前目录和根目录</span>
<span class="n">struct</span> <span class="n">files_struct</span> <span class="o">*</span><span class="n">files</span><span class="p">;</span> <span class="o">//</span><span class="n">files表示进程打开的文件</span>
<span class="n">struct</span> <span class="n">sysv_sem</span> <span class="n">sysvsem</span><span class="p">;</span>    <span class="o">//</span><span class="n">进程通信</span><span class="p">(</span><span class="n">SYSVIPC</span><span class="p">)</span>
<span class="n">struct</span> <span class="n">thread_struct</span> <span class="n">thread</span><span class="p">;</span>        <span class="o">//</span><span class="n">处理器特有数据</span>
<span class="n">struct</span> <span class="n">nsproxy</span> <span class="o">*</span><span class="n">nsproxy</span><span class="p">;</span>            <span class="o">//</span><span class="n">命名空间</span>
<span class="n">struct</span> <span class="n">bio_list</span> <span class="o">*</span><span class="n">bio_list</span><span class="p">;</span>      <span class="o">//</span><span class="n">块设备链表</span>
<span class="n">struct</span> <span class="n">io_context</span> <span class="o">*</span><span class="n">io_context</span><span class="p">;</span>      <span class="o">//</span><span class="n">I</span><span class="o">/</span><span class="n">O调度器所使用的信息</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../process_create/index.html" class="btn btn-neutral float-right" title="2.6.2. 进程创建" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../index.html" class="btn btn-neutral float-left" title="2.6. 进程管理与调度" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; 版权所有 2020, yinwg

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>